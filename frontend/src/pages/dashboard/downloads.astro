---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
const apiUrl = import.meta.env.PUBLIC_API_URL;
---
<DashboardLayout title="Descargas â€” LBOT">
  <div class="max-w-3xl">
    <h1 class="text-xl sm:text-2xl font-bold text-white mb-2">Descargas</h1>
    <p class="text-gray-500 text-sm mb-6 sm:mb-8">Archivos disponibles seg&uacute;n tu plan activo.</p>
    <div id="downloads-content" class="text-gray-400 text-sm">Cargando...</div>
  </div>
</DashboardLayout>

<script is:inline define:vars={{ apiUrl }}>
  async function loadDownloads() {
    var el = document.getElementById('downloads-content');
    if (!el) return;
    try {
      var res = await fetch(apiUrl + '/api/dashboard/downloads', { credentials: 'include' });
      if (!res.ok) { window.location.href = '/'; return; }
      var data = await res.json();
      var downloads = data.downloads;

      if (!downloads.length) {
        el.innerHTML = '<p class="text-gray-500 py-8 text-center">No hay archivos disponibles con tu plan actual.</p>';
        return;
      }

      el.innerHTML = '<div class="space-y-3">' +
        downloads.map(function(file) {
          return '<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 bg-gray-900 border border-gray-800 hover:border-gray-700 rounded-2xl px-4 sm:px-6 py-4 transition-all group">' +
            '<div class="flex items-center gap-3">' +
              '<div class="p-2 bg-brand-600/10 rounded-xl shrink-0">' +
                '<svg class="w-5 h-5 text-brand-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">' +
                  '<path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>' +
                '</svg>' +
              '</div>' +
              '<div>' +
                '<p class="text-white font-semibold text-sm">' + file + '</p>' +
                '<p class="text-gray-600 text-xs mt-0.5">Versi\u00f3n m\u00e1s reciente &middot; Listo para usar</p>' +
              '</div>' +
            '</div>' +
            '<button class="flex items-center justify-center gap-2 text-sm font-semibold px-4 py-2.5 rounded-xl border transition-all ' +
              'text-gray-400 border-gray-700 bg-transparent ' +
              'hover:text-white hover:bg-red-600 hover:border-red-600 hover:shadow-lg hover:shadow-red-600/20 ' +
              'active:scale-95 shrink-0 w-full sm:w-auto" ' +
              'onclick="alert(\'Demo: descarga de ' + file.replace(/'/g, '') + ' simulada.\')">' +
              '<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">' +
                '<path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>' +
              '</svg>' +
              'Descargar' +
            '</button>' +
          '</div>';
        }).join('') +
      '</div>' +
      '<p class="text-xs text-gray-600 mt-6">Los archivos se actualizan con cada versi\u00f3n del bot.</p>';
    } catch (e) {
      el.innerHTML = '<p class="text-red-400">Error cargando descargas.</p>';
    }
  }

  loadDownloads();
</script>
