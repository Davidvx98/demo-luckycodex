---
/**
 * Plans.astro — Cards de planes con fallback estático para demo.
 * Si la API no responde, usa los datos hardcodeados.
 */

// Fallback para demo (coincide con lo que hay en la DB)
const FALLBACK_PLANS = [
  {
    id: 1,
    name: 'Farmer Básico',
    price_usd: 2,
    interval: 'monthly',
    popular: false,
    features: [
      'Bot de farmeo automático de Teras',
      '1 cuenta de DMO',
      'Rutas: Dats Area y Western Area',
      'Soporte por Discord',
      'Actualizaciones incluidas',
    ],
  },
  {
    id: 2,
    name: 'Farmer Pro',
    price_usd: 5,
    interval: 'monthly',
    popular: true,
    features: [
      'Bot de farmeo automático de Teras',
      'Hasta 3 cuentas de DMO',
      'Todas las rutas (Dats, Western, Server, Ice Wall)',
      'Anti-detección mejorado',
      'Configuración de loot personalizada',
      'Soporte prioritario 24/7',
      'Actualizaciones incluidas',
    ],
  },
];
---

<section id="plans" class="py-24 bg-gray-900">
  <div class="max-w-4xl mx-auto px-6">

    <div class="text-center mb-16">
      <h2 class="text-4xl font-bold text-white mb-4">Elige tu plan</h2>
      <p class="text-gray-400 text-lg">Sin compromisos. Cancela cuando quieras.</p>
    </div>

    <!-- Grid de planes: 2 columnas centradas en desktop -->
    <div id="plans-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-2xl mx-auto"
         aria-live="polite">

      <!-- Renderizado server-side con fallback (sin depender de la API para la demo) -->
      {FALLBACK_PLANS.map(plan => (
        <div class={`relative flex flex-col rounded-2xl p-8 border transition-all hover:-translate-y-1 ${
          plan.popular
            ? 'bg-brand-600/10 border-brand-500 shadow-xl shadow-brand-500/10'
            : 'bg-gray-800 border-gray-700'
        }`}>

          {plan.popular && (
            <div class="absolute -top-3.5 left-1/2 -translate-x-1/2">
              <span class="bg-brand-500 text-white text-xs font-bold px-4 py-1 rounded-full tracking-wide uppercase">
                Más popular
              </span>
            </div>
          )}

          <div class="mb-6">
            <h3 class="text-xl font-bold text-white mb-1">{plan.name}</h3>
            <div class="flex items-end gap-1 mt-3">
              <span class="text-5xl font-bold text-white">${plan.price_usd}</span>
              <span class="text-gray-400 mb-1.5">/ mes</span>
            </div>
          </div>

          <ul class="space-y-3 mb-8 flex-1">
            {plan.features.map(f => (
              <li class="flex items-start gap-2.5 text-gray-300 text-sm">
                <svg class="w-4 h-4 text-brand-400 shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                {f}
              </li>
            ))}
          </ul>

          <button
            data-plan-id={plan.id}
            class={`w-full py-3 rounded-xl font-semibold transition-all text-sm ${
              plan.popular
                ? 'bg-brand-600 hover:bg-brand-500 text-white shadow-lg shadow-brand-600/30'
                : 'bg-gray-700 hover:bg-gray-600 text-white'
            }`}>
            Empezar con {plan.name}
          </button>
        </div>
      ))}
    </div>

  </div>
</section>

<script is:inline>
  // Botones "Comprar" → scroll a login con plan preseleccionado
  document.querySelectorAll('[data-plan-id]').forEach(btn => {
    btn.addEventListener('click', () => {
      sessionStorage.setItem('pending_plan', btn.dataset.planId);
      document.getElementById('auth')?.scrollIntoView({ behavior: 'smooth' });
    });
  });
</script>
