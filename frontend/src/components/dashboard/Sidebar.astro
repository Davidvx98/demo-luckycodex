---
/**
 * Sidebar.astro
 * Menú lateral del dashboard con enlace activo resaltado.
 */
interface Props { pathname?: string; }

const apiUrl  = import.meta.env.PUBLIC_API_URL;
const { pathname = Astro.url.pathname } = Astro.props;

const links = [
  { href: '/dashboard',            label: 'Resumen'    },
  { href: '/dashboard/downloads',  label: 'Descargas'  },
  { href: '/dashboard/tutorials',  label: 'Tutoriales' },
  { href: '/dashboard/buy',        label: 'Comprar Bot'},
];
---
<aside class="w-64 bg-gray-900 border-r border-gray-800 flex flex-col h-screen">
  <!-- Logo -->
  <div class="px-6 py-5 border-b border-gray-800">
    <span class="text-xl font-bold text-brand-500">LBOT</span>
  </div>

  <!-- Navegación -->
  <nav class="flex-1 px-4 py-6 space-y-1">
    {links.map(({ href, label }) => {
      const isActive = pathname === href || (href !== '/dashboard' && pathname.startsWith(href));
      return (
        <a
          href={href}
          class={`flex items-center gap-3 px-4 py-2.5 rounded-lg transition text-sm font-medium ${
            isActive
              ? 'bg-brand-600/20 text-brand-400 border border-brand-600/30'
              : 'text-gray-400 hover:text-white hover:bg-gray-800'
          }`}>
          {label}
        </a>
      );
    })}
  </nav>

  <!-- Logout -->
  <div class="px-4 py-4 border-t border-gray-800">
    <button
      id="btn-logout"
      class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-400 hover:text-red-400 hover:bg-gray-800 transition text-sm font-medium w-full">
      Cerrar sesión
    </button>
  </div>
</aside>

<script is:inline define:vars={{ apiUrl }}>
  document.getElementById('btn-logout')?.addEventListener('click', async () => {
    await fetch(`${apiUrl}/api/auth/logout`, {
      method:      'POST',
      credentials: 'include',
    });
    window.location.href = '/';
  });
</script>
